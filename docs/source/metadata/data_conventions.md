# Data Conventions 

### Primary Data Conventions

All data acquired in a single acquisition session is stored together. This group needs a simple, readable, and uniue name that facilitates casual browsing. The data assets should be named according to the conventions outlined below. 

All primary data assets follow this format:

    <platform-abbreviation>_<subject-id>_<acquisition-date>_<acquisition-time>

A few points:

- A platform is a standardized system for collecting one or more modalities of data.
- All tokens (e.g., `<platform-abbreviation>`, `<subject-id>`) must not contain underscores or illegal filename characters  
- `<platform-abbreviation>`: a less-than-10-character shorthand for a data acquisition platform  
- `<acquisition-date>`: `yyyy-mm-dd` 
- `<acquisition-time>`: `hh-mm-ss` 
- Acquisition date and time are essential for uniqueness  
- Acquisition date and time are in the local time zone  
- Time zone is documented in metadata  

#### Primary Data Assets Organization

Primary data assets are organized as follows:

- `<asset name>`  
  - `data_description.json` (administrative information, funders, licenses, projects, etc.)  
  - `subject.json` (species, sex, DOB, unique identifier, genotype, etc.)  
  - `procedures.json` (subject surgeries, tissue preparation, water restriction, training protocols, etc.)  
  - `instrument.json`/`rig.json` (static hardware components)  
  - `acquisition.json`/`session.json` (device settings that change acquisition-to-acquisition)  
  - `<modality-1>`  
    - `<list of data files>`  
  - `<modality-2>`  
    - `<list of data files>`  
  - `<modality-n>`  
    - `<list of data files>`  
  - `derivatives` (processed data generated during acquisition)  
    - `<label>` (e.g., MIP)  
      - `<list of files>`  
  - `logs` (general log files generated by the instrument or rig that are not modality-specific)  
    - `<list of files>`  

Platform abbreviation and modality terms come from controlled vocabularies in `aind-data-schema-models`.

##### Example: Simultaneous Electrophysiology with Optotagging and Fiber Photometry

- **EFIP_655568_2022-04-26_11-48-09**
    - `<metadata JSON files>`  
    - **FIB**  
        - `L415_2022-04-26T11_48_09.csv`  
        - `L470_2022-04-26T11_48_09.csv`  
        - `L560_2022-04-26T11_48_09.3024512-07_00`  
        - `Raw2022-04-26T11_48_09.csv`  
        - `TTL_2022-04-26T11_48_08.1780864-07_00`  
        - `TTL_TS2022-04-26T11_48_08.csv`  
        - `TimeStamp_2022-04-26T11_48_08.csv`  
    - **ecephys**  
        - `220426114809_655568.opto.csv`  
        - **Record Node 104**  
            - `<files>`  
    - **behavior-videos**  
        - `face_camera.mp4`  
        - `body_camera.mp4`  

##### Example: Lightsheet Microscopy Data Acquired on the ExaSPIM Platform

- **exaSPIM_655568_2022-04-26_11-48-09**  
    - `<metadata JSON files>`  
    - **SPIM**  
        - `SPIM.ome.zarr`  
    - **derivatives**  
        - **MIP**  
            - `<list of e.g., tiff files>`  

# Derived Data Conventions

Anything computed in a single run should be logically grouped in a folder. The folder should be named:

    <primary-asset-name>_<process-label>_<process-date>_<process-time>

For example:

- `exaSPIM_ANM457202_2022-07-11_22-11-32_processed_2022-08-11_22-11-32`
- `ecephys_595262_2022-02-21_15-18-07_processed_2022-08-11_22-11-32`

Processed outputs are usually the result of a multi-stage pipeline, so often `<process-label>` should just be `processed`. Another common process label includes: 

- `curation` - tags assigned to input data (e.g., merge/split/noise calls for ephys units)  

Overly long names are difficult to read, so do not daisy-chain. The goal is to keep names as simple as possible while being readable, not to encode all metadata or the entire provenance chain. If various stages of processing are being performed manually over extended periods of time, anchor each derived asset on the primary data asset.

### Processed Result Folder Organization

Processed result folders are organized as follows:

- `<asset name>`  
  - `data_description.json`  
  - `processing.json` (describes the code, input parameters, outputs)  
  - `subject.json` (copied from primary asset)  
  - `procedures.json` (copied from primary asset)  
  - `instrument.json` (copied from primary asset)  
  - `acquisition.json` (copied from primary asset)  
  - `<process-label-1>`  
    - `<list of files>`  
  - `<process-label-2>`  
    - `<list of files>`  
  - `<process-label-n>`  
    - `<list of files>`  

### File Name Guidelines

When naming files:

- Use terms from vocabularies defined in `aind-data-schema`
  - Platform names and modalities behavior video file names  
  - Use `yyyy-mm-dd` and `hh-mm-ss` in local time zone for dates and times  
- Separate tokens with underscores, and not include underscores in tokens, e.g.:  
  - Do this: `EFIP_655568_2022-04-26_11-48-09`  
  - Not this: `EFIP-655568-2022_04_26-11_48_09`  
- Do not include illegal filename characters in tokens  


